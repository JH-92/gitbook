---
description: 1장 사용자 수에 따른 규모확장성을 읽고 요약한 내용입니다.
---

# 사용자 수에 따른 규모확장성



## 사용자의 요청이 처리되는 과정

1. 도메인 이름을 이용해 웹사이트에 접속
2. DNS에 질의하여 IP주소로 변환(3자 사업자)
3. IP주소로 HTTP요청이 전달
4. 요청을 받은 웹서버가 HTML 페이지나 JSON으로 응답

사용자의 요청은 모바일앱, 웹 앱 두가지 방식



## 데이터베이스

### RDBMS

* MySQL, Oracle, PostgreSQL
* 테이블, 열, 컬럼으로 표현
* 데이터를 관계에 따라 join하여 표현

### NoSQL

* Cassandra, HBase, DynamoDB
* Key-value store, graph store, column store, document store
* 일반적으로 join은 지원하지않음
* 아주 낮은 응답 latency, 다루는 데이터가 비정형, 많은 양의 데이터를 저장할 필요가 있는 경우 선택

## 규모의 확장

### 수직적 규모확장(scale up)

* 서버를 고사양으로 변경(CPU, RAM)
* 트래픽의 양이 적을 때(고성능을 필요로하는 작업이 있을때)

#### 단점

* 한대의 서버에 CPU와 RAM을 무한대로 증설할 수 없다.
*   장애에 대한 failover나 다중화 방안은 고려하지 않는다

    : 서버에 장애가 발생하면 웹/앱이 중단

### 수평적 규모확장(scale out)

* 더 많은 수의 서버를 사용

### 로드밸런서

* 여러대의 웹 서버를 사용하는 경우 사용(수평적 규모확장의 예)
* 사용자의 요청은 웹서버로 직접 오는게 아닌 로드밸런스의 공개IP 주소로 접속됨
* 서버간 통신에는 사설IP주소 사용
* failover 문제 해결, 가용성 증가\
  이제 웹계층은 된거같은데 데이터 계층은?

### 데이터베이스 다중화

* master(주)-slave(부)
  * master: 쓰기연산(insert, update, delete)
  * slave: 읽기연산
* 보통의 경우 읽기연산이 쓰기연산보다 많다\
  : 부 데이터베이스가 더 많아야 한다.

#### 장점

* 성능: 부 데이터베이스의 존재로 인해 읽기연산을 분산시킬수 있으므로 처리량이 많아진다.
* 안정성: 데이터베이스 서버가 일부 파괴되어도 데이터가 보존된다.
* 가용성: 일부 서버에 장애가 발생해도 다른 서버의 데이터로 계속 서비스할 수 있다.

### 캐시

* 자주 참조되는 데이터를 일시적으로 저장하는 용도
* 데이터베이스보다 빠르고 부하를 줄여주는 역할
* 독립적으로 규모 확장 가능

#### 캐시 사용시 유의할점

* 갱신이 자주 일어나지 않지만 참조가 빈번하게 일어나는 경우에 사용
* 임시로 저장할 데이터만 저장(캐시서버가 재시작되면 모든 데이터 삭제)
* 캐시에 보관된 데이터의 만료 정책
* 캐시의 데이터가 데이터베이스의 원본과의 일관성 유지
* 장애에 대한 대처(단일장애지점, SPOF)
* 캐시메모리의 크기
* 캐시 데이터 방출 정책(LRU, LFU, FIFO)

### CDN(콘텐츠 전송 네트워크)

* 정적 콘텐츠를 전송
* 지리적으로 분산된 서버의 네트워크
* 서버가 멀리있다면 로딩이 길어짐
* 이미지, 비디오, CSS, JS파일 등을 캐시
* 고려해야 할 사항이 캐시와 유사

### 무상태(stateless) 웹 계층

#### (비교)상태정보 의존적 아키텍처

* 상태를 유지하여 요청들을 공유
* 서버가 3대인 경우 같은 클라이언트의 요청이 항상 같은 서버로 전송(sticky session)
* sticky session 이 로드밸런서에 부담(부하분산 관점)
* 서버 장애 처리 복잡도 증가

#### 무상태 웹 계층

* 사용자의 요청이 여러대의 웹서버중 어디에나 전달 가능
* 상태정보가 필요한 경우 공유저장소에서 데이터 로드\
  : 상태정보가 웹서버로부터 물리적으로 분리됨
* 로드밸런서가 부하분산을 하기에 적합

### 데이터센터

* 여러개의 데이터센터를 이용
* 로드밸런서를 통해 지리적 라우팅
* 트래픽, 데이터동기화, 배포등의 기술적 과제가 주어짐

### 메시지 큐

* 메시지의 버퍼역할을 하여 무손실을 보장하는 비동기 통신 컴포넌트
* 생산자/발행자(producer/publisher)가 메시지를 메시지큐에 발행(produce/publish)
* 큐에 소비자/구독자(consumer/subscriber)가 연결되어 그에 맞는 동작을 수행
* 서버간 결합이 느슨해져 규모의 수평적 확장이 보장되어야 할때 사용

### 로그

* 에러로그의 모니터링\
  : 시스템의 오류와 문제를 쉽게 찾아내도록 도움
* 로그를 단일 서비스로 모아주는 도구 사용시 더욱 유용

### 메트릭

* 시스템의 현재 상태 파악
* 호스트단위 메트릭: CPU, 메모리, 디스크I/O 등
* 종합 메트릭: DB계층 성능, 캐시계층 성능 등
* 핵심 비즈니스 메트릭: DAU, 수익, retention 등

### 자동화

* CI/CD
* 빌드, 테스트 자동화
*
